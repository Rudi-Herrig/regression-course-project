---
title: "(Project Paper 1 - Revised +) Project Paper 2"
author: "Rudi Herrig and Jordan Kim"
date: "5 May 2024"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
library(knitr)
library(tinytex)
library(readxl)
library(tidyverse)
library(stringr)
library(magrittr)
library(ggplot2)
# install.packages("corrr")
library(corrr)
# install.packages("corrplot")
library(corrplot)

knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(out.width = "60%",fig.align='center')
```

I wanted to try creating a binary response variable indicating whether a county joined the South because the state in which it is located fought against the Union. I will use the following states: Alabama, Arkansas, Florida, Georgia, Louisiana, Mississippi, North Carolina, South Carolina, Tennessee, Texas, and Virginia. I will create a new variable, Confederate, which is equal to 1 if the county is in one of these states, and 0 if the county is not in one of these states. I will use the mutate function to create this new variable.

```{r}
# 1279 rows
# Population data
population <- read_xlsx("USCensus_1840_counties.xlsx")
population <- population %>%
  dplyr::select(-COUNTYA,-COUNTYICP,-AREANAME) # removing COUNTY and COUNTYA columns, which, when used as a factor, would create too many levels
population <- population[-c(101,103),] # removing Alexandria and Rural Alexandria County rows

# Adding the industry, manufacturing, and navigable waterway data to the population data
# 1279 rows
# ADB - production of industries
# ADE - Men employed in selected industries
production <- read_xlsx("USCensus_1840_county.xlsx")
production <- production %>%
  dplyr::select(-COUNTYA,-COUNTYICP,-AREANAME) # removing COUNTY and COUNTYA columns, which, when used as a factor, would create too many levels
production <- production[-102,] # removing Rural Alexandria County row

agriculture <- read_xlsx("USCensus_1840_agriculture.xlsx")
agriculture <- agriculture %>%
  dplyr::select(-COUNTYA,-COUNTYICP,-AREANAME) # removing COUNTY and COUNTYA columns, which, when used as a factor, would create too many levels
agriculture <- agriculture[-101,] # removing Alexandria County row
```

```{r}
# Specify the columns you want to join on explicitly
join_columns <- c("GISJOIN", "YEAR", "STATE", "STATEA", "STATEICP", "COUNTY")

# bigpop is all our data aggregated
bigpop <- population %>%
  inner_join(production, by = join_columns) %>%
  inner_join(agriculture, by = join_columns)
#   inner_join(capital, by = join_columns)
```

```{r}
# separating header row to further clean up the data set
bigpophead <- bigpop %>% slice_head()

# removing header row
bigpopdata <- bigpop[-1,]

# Converting our data from chr to dbl with as.numeric()
bigpop[,7:ncol(bigpop)] <- as.data.frame(apply(bigpop[,7:ncol(bigpop)], 2, function(x) (as.numeric(x))))
bigpopdata[,7:ncol(bigpopdata)] <- as.data.frame(apply(bigpopdata[,7:ncol(bigpopdata)], 2, function(x) (as.numeric(x))))

# Replace all NA values with 0 in the bigpop data frame
bigpop[is.na(bigpop)] <- 0
bigpopdata[is.na(bigpopdata)] <- 0

# population_head <- population %>% slice_head() # separating header row to further clean up the data set
# popdata <- population[-1,] # removing header row


# Creating new variables
bigpopdata <- bigpopdata %>%
  mutate(STATE=as.factor(STATE),
         ACZYZ=ACZ/(ACY+ACZ), # ACZYZ is the Percentage of Colored population
         ACKY=ACK001/ACY, # ACKY is the Percentage of White Illiteracy
         ACH=ACH001+ACH002+ACH003, # ACH is the total number of Learning Institutions
         ACI=ACI001+ACI002+ACI003, # ACI is the total number of Students
         ACL=ACL001+ACL002, # ACL is Number of Printing and Binding Services
         ACM=ACM001+ACM002+ACM003+ACM004, # ACM is Number of Newspapers and Periodicals
         AC1=AC1003+AC1004+AC1005+AC1006+AC1007, # AC1 is the total number of Employed persons in Learned Professions Requiring Literacy
         ACE=AC3003+ACE001, # ACE is the number of White Deaf, Dumb, and Blind Persons Over 20
         AC3=AC3001+AC3002+AC3003, # AC3 is the Total White Persons Who are Deaf, Dumb, or Blind
         AC9M = AC9001 + AC9002 + AC9003 + AC9026, # Total Number of Mining Establishments
         AC9C = AC9004 + AC9005 + AC9006 + AC9007, # Total Number of Commerce Establishments
         AC9MF = AC9008 + AC9009 + AC9010 + AC9011 + AC9012 + AC9013 + AC9014 + AC9015 + AC9016 + AC9017 + AC9018 + AC9019 + AC9020 + AC9021 + AC9022 + AC9023 + AC9024 + AC9025 + AC9027 + AC9028 + AC9029 + AC9030, # Total Number of Manufacturing Establishments
         ACS=ACS001+ACS002+ACS003, # ACS is Total Persons
         ADAF = ADA004 + ADA005 + ADA006, # Total Produced Value of Forest Products
         ADAMF = ADA007 + ADA008 + ADA009 + ADA010 + ADA011 + ADA012 + ADA013 + ADA014 + ADA015 + ADA016 + ADA017 + ADA018 + ADA019 + ADA020 + ADA021 + ADA022 + ADA023 + ADA024 + ADA025 + ADA026 + ADA027 + ADA028 + ADA029 + ADA030 + ADA031 + ADA032 + ADA033 + ADA034 + ADA035 + ADA036 + ADA040 + ADA041, # Total Produced Value of Manufacturing Products
         ADAM = ADA037 + ADA038 + ADA039, # Total Produced Value of Mining Products
         ADCM = ADC001 + ADC002 + ADC003 + ADC004 + ADC005 + ADC006 + ADC007 + ADC008, # Capital invested in Mining Establishments
         ADCC = ADC009 + ADC010 + ADC011 + ADC012 + ADC013, # Capital invested in Commerce Establishments
         ADCMFF = ADC014, # Capital invested in Manufacturing Establishments: Fisheries
         ADCMFM = ADC015, # Capital invested in Manufacturing Establishments: Machinery
         ADCMFT = ADC016 + ADC017 + ADC018 + ADC019 + ADC020, # Capital invested in Manufacturing Establishments: Textiles
         ADCMFTH = ADC021 + ADC022, # Capital invested in Manufacturing Establishments: Tobacco and Hats
         ADCMFL = ADC023 + ADC024, # Capital invested in Manufacturing Establishments: Leather
         ADCMFSCL = ADC025 + ADC026, # Capital invested in Manufacturing Establishments: Soap, Candles, and Liquors
         ADCMFC = ADC027 + ADC028, # Capital invested in Manufacturing Establishments: Chemicals
         ADCMFGE = ADC029 + ADC030, # Capital invested in Manufacturing Establishments: Glass and Earthenware
         ADCMFFP = ADC031, # Capital invested in Manufacturing Establishments: Food Processing
         ADCMFPP = ADC032 + ADC033, # Capital invested in Manufacturing Establishments: Paper and Printing
         ADCMFO = ADC034 + ADC035 + ADC036 + ADC037 + ADC038 + ADC039, # Capital invested in Manufacturing Establishments: Other
         ADEM = ADE001 + ADE002 + ADE003 + ADE004 + ADE005 + ADE006 + ADE007 + ADE008, # Men employed by Mining Establishments
         ADEC = ADE010 + ADE011 + ADE012,  # Men employed by Commerce Establishments
         ADEMF = ADE014 + ADE015 + ADE016 + ADE017 + ADE018 + ADE019 + ADE020 + ADE021 + ADE022 + ADE023 + ADE024 + ADE025 + ADE026 + ADE027 + ADE028 + ADE029 + ADE030 + ADE031 + ADE032 + ADE033 + ADE034 + ADE035 + ADE036, # Men employed by Manufacturing Establishments
         AC5 = AC5001 + AC5002 + AC5003 + AC5004 + AC5005 + AC5006 + AC5007 + AC5008 + AC5009, # Persons Employed Textile and Leather Manufacturing Establishments
         AB2 = AB2001 + AB2002 + AB2003 + AB2004, # Total Livestock Animals
         AB5 = AB5001 + AB5002 + AB5003 + AB5004 + AB5005, # Total Value of Non-Field-Crop Products
         AB8 = AB8001 + AB8002 + AB8003 + AB8004 + AB8005 + AB8006 + AB8007 + AB8008 + AB8009 + AB8010 + AB8011 + AB8012 + AB8013 + AB8014 + AB8015 + AB8016 + AB8017 + AB8018 + AB8019 + AB8020 + AB8021 + AB8022, # Total Estimated Value of Farm Productions
         ACSW= ACS001, # ACSW is Total White Persons
         ACSNW= ACS002+ACS003, # ACSNW is Total Non-White Persons
         ACSP=ACSNW/ACS, # ACSP is the percentage of non-white population
         ACSWP=ACSW/ACS, # ACSWP is the percentage of white population
         Confederate=as.integer(STATE %in% c("Alabama", "Arkansas", "Florida", "Georgia", "Louisiana", "Mississippi", "North Carolina", "South Carolina", "Tennessee", "Texas", "Virginia")))

bigpopdatahead <- bigpophead %>%
  mutate(ACD001="Total Population",
         ACN001="Total Urban Population",
         ACZYZ="Percentage of Colored Population",
         ACKY="Percentage of White Illiteracy",
         ACH="Total Learning Institutions",
         ACI="Total Number of Students",
         ACL="Number of Printing and Binding Services",
         ACM="Number of Newspapers and Periodicals",
         AC1="Total Employed in Learned Professions",
         ACE="White Deaf, Dumb, and Blind Persons Over 20",
         AC3="Total White Persons Who are Deaf, Dumb, or Blind",
         AC9M = "Total Number of Mining Establishments",
         AC9C = "Total Number of Commerce Establishments",
         AC9MF = "Total Number of Manufacturing Establishments",
         ADAF = "Total Produced Value of Forest Products",
         ADAMF = "Total Produced Value of Manufacturing Products",
         ADAM = "Total Produced Value of Mining Products",
         ADCM = "Capital invested in Mining Establishments",
         ADCC = "Capital invested in Commerce Establishments",
         ADCMFF = "Capital invested in Manufacturing Establishments: Fisheries",
         ADCMFM = "Capital invested in Manufacturing Establishments: Machinery",
         ADCMFT = "Capital invested in Manufacturing Establishments: Textiles",
         ADCMFTH = "Capital invested in Manufacturing Establishments: Tobacco and Hats",
         ADCMFL = "Capital invested in Manufacturing Establishments: Leather",
         ADCMFSCL = "Capital invested in Manufacturing Establishments: Soap, Candles, and Liquors",
         ADCMFC = "Capital invested in Manufacturing Establishments: Chemicals",
         ADCMFGE = "Capital invested in Manufacturing Establishments: Glass and Earthenware",
         ADCMFFP = "Capital invested in Manufacturing Establishments: Food Processing",
         ADCMFPP = "Capital invested in Manufacturing Establishments: Paper and Printing",
         ADCMFO = "Capital invested in Manufacturing Establishments: Other",
         ADEM = "Men employed by Mining Establishments",
         ADEC = "Men employed by Commerce Establishments",
         ADEMF = "Men employed by Manufacturing Establishments",
         AC5 = "Persons Employed Textile and Leather Manufacturing Establishments",
         AB2 = "Total Livestock Animals",
         AB5 = "Total Value of Non-Field-Crop Products",
         AB8 = "Total Estimated Value of Farm Productions",
         ACS="Total Persons",
         ACSW="Total White Persons",
         ACSNW="Total Non-White Persons",
         ACSP="Percentage of Non-White Population",
         ACSWP="Percentage of White Population",
         Confederate="Joined Confederacy and Raised Arms Against The United States = 1")


# Re-adding the header row with new descriptions - but this converted the whole list into 'chr' NO!!!!
# Create a list to keep them together but separate for statistical analyses
bigpopdata_list <- list(Headers = bigpopdatahead, Data = bigpopdata)

# glimpse(popdata_list)
```

Filtering for only the columns we're interested in and creating a new list `WhiteIlliterate`
```{r}
# WhiteIlliteracy <- popdata_list$Data  %>%
#   select(GISJOIN, STATE, STATEA, STATEICP, COUNTY, COUNTYA, COUNTYICP, ACD001, ACN001,  ACK001, ACY, ACKY, ACZYZ, ACH, ACI, ACL, ACM, AC1, ACE, ACS, ACSW, ACSNW, ACSP, ACSWP, Confederate)
# glimpse(WhiteIlliteracy)
# WhiteIlliteracyHead <- popdata_list$Headers %>%
#   select(GISJOIN, STATE, STATEA, STATEICP, COUNTY, COUNTYA, COUNTYICP, ACD001, ACN001,  ACK001, ACY, ACKY, ACZYZ, ACH, ACI, ACL, ACM, AC1, ACE, ACS, ACSW, ACSNW, ACSP, ACSWP, Confederate)
# glimpse(WhiteIlliteracyHead)
# WhiteIlliterate <- list(Headers = WhiteIlliteracyHead, Data = WhiteIlliteracy)
# glimpse(WhiteIlliterate)
WhiteIlliteracy <- bigpopdata %>%
  dplyr::select(-c(1:2,4)) # removing unnecessary columns
WhiteIlliteracyHead <- bigpopdatahead %>%
  dplyr::select(-c(1:2,4)) # removing unnecessary columns
WhiteIlliterate <- list(Headers = WhiteIlliteracyHead, Data = WhiteIlliteracy)
```

```{r, include=FALSE}
if (!dir.exists("figures")) {
  dir.create("figures")
}
```
### Visualizing data we're interested in to learn more about relationships among data set with Blue representing Union counties and Red representing Confederate counties
#### The visualization of the response variable, White Illiteracy, with Percentage of Non-White Population as potential predictor
```{r, fig.path="figures/", message=FALSE}
ACSP <- ggplot(WhiteIlliterate$Data, aes(x=ACSP, y=ACKY, color=factor(Confederate))) +
  geom_point(alpha=0.2) +
  geom_jitter(height=0.05, size=2, alpha=0.6) +
  scale_color_manual(values=c("0"="blue", "1"="red"),
                     labels=c("Union", "Confederate"),
                     name="Civil War Alignment") +
  theme_bw() +
  labs(x="Percentage of Non-White Population", y="White Illiteracy Rate (%)",
       title="Impact of Racial Composition on White Illiteracy",
       subtitle="Comparison by Civil War Alignment")
ACSP
ggsave("ACSP.png", plot=ACSP)
```

#### Visualizing the response variable, White Illiteracy, with Number of Newspapers and Periodicals produced as potential predictor
```{r, fig.path="figures/", message=FALSE}
ACM <- ggplot(WhiteIlliterate$Data, aes(x=ACM, y=ACKY, color=factor(Confederate))) +
  geom_point(alpha=0.2) +
  geom_jitter(height=0.05, size=2, alpha=0.6) +
  scale_color_manual(values=c("0"="blue", "1"="red"),
                     labels=c("Union", "Confederate"),
                     name="Civil War Alignment") +
  theme_bw() +
  labs(x="Number of Newspapers and Periodicals", y="White Illiteracy Rate (%)",
       title="Implicating Impact of Newspapers Media Produced on White Illiteracy Rate",
       subtitle="Comparison by Civil War Alignment")
ACM
ggsave("ACM.png", plot=ACM)
```

#### Visualizing the response variable, White Illiteracy, with Number of Students as potential predictor
```{r, fig.path="figures/", message=FALSE}
ACI <- ggplot(WhiteIlliterate$Data, aes(x=ACI, y=ACKY, color=factor(Confederate))) +
  geom_point(alpha=0.2) +
  geom_jitter(height=0.05, size=2, alpha=0.6) +
  scale_color_manual(values=c("0"="blue", "1"="red"),
                     labels=c("Union", "Confederate"),
                     name="Civil War Alignment") +
  theme_bw() +
  labs(x="Number of Students", y="White Illiteracy Rate (%)",
       title="Impact of Educational Enrollment on Literacy",
       subtitle="Comparison by Civil War Alignment")
ACI
ggsave("ACI.png", plot=ACI)
```

#### Visualizing the relationship between the Number of Learning Institutions and White Illiteracy
```{r, fig.path="figures/", message=FALSE}
ACH <- ggplot(WhiteIlliterate$Data, aes(x=ACH, y=ACKY, color=factor(Confederate))) +
  geom_point(alpha=0.2) +  
  geom_jitter(height=0.05, size=2, alpha=0.6) +  
  scale_color_manual(values=c("0"="blue", "1"="red"),  # Colors for Union and Confederate
                     labels=c("Union", "Confederate"),
                     name="Civil War Alignment") +
  theme_bw() +
  labs(x="Number of Learning Institutions",
       y="White Illiteracy Rate (%)",
       title="Influence of Educational Institutions on Literacy",
       subtitle="Comparison by Civil War Alignment")
ACH
ggsave("ACH.png", plot=ACH)
```

#### Visualizing the response variable, White Illiteracy, with Number of Persons in Learned Professions Requiring Literacy as potential predictor
```{r, fig.path="figures/", message=FALSE}
AC1 <- ggplot(bigpopdata, aes(x=AC1, y=ACKY, color=factor(Confederate))) +
  geom_jitter(width=0.2, height=0.2, alpha=0.6) + 
  scale_color_manual(values=c("0"="blue", "1"="red"),  # Colors for Union and Confederate
                     labels=c("0"="Union", "1"="Confederate"),
                     name="Civil War Alignment") + 
  theme_bw() + 
  labs(x="Number of Persons in Learned Professions",
       y="White Illiteracy Rate (%)",
       title="Civil War Alignment by County",
       subtitle="Based on Confederate or Union alignment during the Civil War")
AC1
ggsave("AC1.png", plot=AC1)
```

### Visualizing new binary variable, `Confederate`, as potential response, with White Illiteracy as potential predictor
```{r, fig.path="figures/"}
Confederate <- ggplot(WhiteIlliterate$Data, aes(x=ACKY, y=Confederate)) +
  geom_point() +
  geom_jitter(height=0.05,size=2,alpha=0.2) +
  theme_bw()
Confederate
ggsave("Confederate.png", plot=Confederate)
```

```{r}
# I wanted to write the cleaned up data frame into a file.
# install.packages("openxlsx")
# library(openxlsx)

# Create a new workbook
# wb <- createWorkbook()
# Add sheets to the workbook
# addWorksheet(wb, "Data")
# addWorksheet(wb, "Headers")
# Write data to the respective sheets
# writeData(wb, sheet = "Data", WhiteIlliteracy)
# writeData(wb, sheet = "Headers", WhiteIlliteracyHead)
# Save the workbook
# saveWorkbook(wb, "WhiteIlliterate.xlsx", overwrite = TRUE)

# Repeat the process for the other list
# wb_bigpopdata <- createWorkbook()
# addWorksheet(wb_bigpopdata, "Data")
# addWorksheet(wb_bigpopdata, "Headers")
# writeData(wb_bigpopdata, sheet = "Data", bigpopdata_list$Data)
# writeData(wb_bigpopdata, sheet = "Headers", bigpopdata_list$Headers)
# saveWorkbook(wb_bigpopdata, "bigpopdata.xlsx", overwrite = TRUE)
```


# Null Model
```{r}
mean(WhiteIlliteracy$ACKY)
```
The mean White Illiteracy Rate for counties is $0.149582$, or $14.96\%$. We will use the RMSE to evaluate our models' performances. We will also look at the distributions of the predictor variables and the correlation between the predictor variables and the response variable.

We will also utilize various techniques to try to find the best model, from shrinkage, dimension reduction, model selection and variable selection. We will also look at the distributions of the predictor variables and the correlation between the predictor variables and the response variable.

# Splitting Data into Training and Testing Sets
```{r}
# ready to split into training and testing data 3:1
set.seed(303)

trows <- sample(x=nrow(WhiteIlliterate$Data),size=floor(0.75*nrow(WhiteIlliterate$Data)),replace=FALSE)
#separate data
train <- WhiteIlliterate$Data[trows,]
train <- train %>%
  dplyr::select(-ACK001)
test <- WhiteIlliterate$Data[-trows,]
test <- test %>%
  dplyr::select(-ACK001)
traindata <- train[4:ncol(train)]
testdata <- test[4:ncol(train)]
alldata <- WhiteIlliteracy[4:ncol(train)]
alldata <- alldata %>%
  dplyr::select(-ACK001)
```


# Forward Stepwise Variable Selection
```{r}
# Load the olsrr package
library(olsrr)
# Load the MASS package
library(MASS)
#define the ols model
model <- glm(ACKY~.-STATE-STATEICP-COUNTY,data=train, family = "gaussian")

# Perform forward stepwise model selection using stepAIC
stepwise_model <- stepAIC(model, direction = "forward", trace = 1)

# Review the selected model
model_summary <- summary(stepwise_model)

# Extract the coefficients table from the summary
coefficients_table <- model_summary$coefficients

# Filter for significant coefficients at the 99% confidence level
significant_coefficients <- coefficients_table[coefficients_table[, "Pr(>|t|)"] < 0.01, ]

# Print significant coefficients
print(significant_coefficients)
```
Forward Stepwise Selection using OLS led to just `AB2002` and `AB4017` as predictor variables. We will use these variables to build a multiple linear regression model.

```{r}
# building multiple linear regression model using training dataset
forwardmodel <- glm(ACKY~AB2002 + AB4017, data = train, family = "gaussian")
predictions <- predict(forwardmodel, newdata = test, type="response")
RMSE_forward <- sqrt(mean((test$ACKY - predictions)^2))
RMSE_forward
```
### And our Forward Stepwise selection method using AIC as criteria gave us a model using `AB2002` and `AB4017` as predictor variables, with a testing RMSE of $0.1361309$.


# Ridge and Lasso Regression (plus OLS glm)
```{r}
#define X matrices
x_train <- model.matrix(ACKY~.,data=traindata)[,-1]
x_test <- model.matrix(ACKY~.,data=testdata)[,-1]

#define y vector
y_train <- traindata$ACKY
y_test <- testdata$ACKY
```

```{r}
#load glmnet library
library(glmnet)
lambda_cv <- cv.glmnet(x=x_train,y=y_train,family="gaussian",alpha=1,nfolds=5)
plot(lambda_cv)
```
```{r}
png("cvplot.png", width = 1200, height = 1200, res=144)
plot(lambda_cv)
dev.off()
```


```{r}
lambda_best <- lambda_cv$lambda.min
lambda_best
```


```{r}
#fit models
model_ols <- glm(ACKY~.,data=traindata,family="gaussian")
model_ridge <- glmnet(x=x_train,y=y_train,family="gaussian", standardize=TRUE, alpha=0)
model_lasso <- glmnet(x=x_train,y=y_train,family="gaussian",standardize=TRUE,alpha=1)

# summary(model_ols)

# testing lasso rmse
test_pred_lasso <- predict(model_lasso,newx=x_test,s=lambda_best,type="response")

RMSE_lasso=sqrt(mean((test$ACKY-test_pred_lasso)^2))
RMSE_lasso

# testing ordinary least squares and ridge regression model RMSE
test_pred_ols=predict(model_ols,newdata=test,type="response")
test_pred_ridge=predict(model_ridge,newx=x_test,s=lambda_best,type="response")

RMSE_ols=sqrt(mean((test$ACKY-test_pred_ols)^2))
RMSE_ols
RMSE_ridge=sqrt(mean((test$ACKY-test_pred_ridge)^2))
RMSE_ridge
```
Our glm model using Ordinary Least Squares model yielded RMSE of $0.7520277$.
Our model using Ridge Regression model yielded RMSE of $0.1524679$.
Our best model was using Lasso Regression model with testing RMSE of $0.1248152$.

# building full lasso model using all data
```{r}
#convert all sample data to matrix form
x_all <- model.matrix(ACKY~.,data=alldata)[,-1]
y_all <- alldata$ACKY

#fit lasso model using all sample data
model_best <- glmnet(x=x_all,y=y_all,family="gaussian",standardize=TRUE,alpha=1)

#view coefficients for best model
coefficients <- predict(model_best,type="coefficients",s=lambda_best)
# rownames(coefficients)[-1]
# Convert the sparse matrix to a regular numeric vector
coefficients_vector <- as.vector(coefficients)
coefficients_vector[length(coefficients_vector)]
# Get the names of all predictors
predictor_names <- rownames(coefficients) # remove intercept

# Combine names and coefficients into a named vector
named_coefficients <- setNames(coefficients_vector, predictor_names)

# Filter to find non-zero coefficients
non_zero_coefficients <- named_coefficients[named_coefficients != 0]

# Print the names of the variables with non-zero coefficients
non_zero_coefficients[-1] # exclude the intercept

names(non_zero_coefficients[2:15])
```
For ACKY as the response variable and only using the numerical data in the predictive model, but using all data, we get the following predictor variables with non-zero coefficients: "ACZ015", "ACM002", "ACX001", "AC9022", "AC9023", "AC9027", "ADA015", "ADB028", "ADC037", "AB4009", "AB7008", "AB7013", "AB7020", and "AB9001".

```{r}
LassoVariablesSelected <- WhiteIlliteracyHead[c("ACZ015", "ACM002", "ACX001", "AC9022", "AC9023", "AC9027", "ADA015", "ADB028", "ADC037", "AB4009", "AB7008", "AB7013", "AB7020", "AB9001")]
summary(LassoVariablesSelected)

# Extract descriptions for the variables with non-zero coefficients
variable_descriptions <- LassoVariablesSelected

# Since the output may be in a format that's not easy to read or handle (like a list or matrix row),
# convert it to a more readable format, such as a named vector or data frame
descriptions_vector <- as.vector(t(variable_descriptions))

# Set names for easy readability
names(descriptions_vector) <- names(LassoVariablesSelected)

# Print descriptions
print(descriptions_vector)
```
For ACKY as the response variable, Lasso gave us a model with the following predictor variables:


- ACZ015 - Slave >> Male >> 24 to 35 years of age
- ACM002 - Weekly newspapers
- ACX001 - 0=NO 1=YES (Navigable Waterway)
- AC9022 - Total Number of Establishments: Manufacturing: Mills: Flouring mills
- AC9023 - Total Number of Establishments: Manufacturing: Mills: Grist mills
- AC9027 - Total Number of Establishments: Manufacturing: Distilled and Fermented Liquors: Distilleries
- ADA015 - Total Value of Production of Establishments: Manufacturing Products: Earthenware manufactured articles
- ADB028 - Total Produced Number of Printing and Binding: Weekly newspapers
- ADC037 - Capital Invested in Manufacturing Establishments: Mills
- AB4009 - Various crops: Beeswax (pounds)
- AB7008 - Various crops: Hops (pounds)
- AB7013 - Various crops: Hemp (tons)
- AB7020 - Cotton, silk, sugar, etc.: Cane sugar (pounds)
- AB9001 - Estimated total crop output value





# Mistakenly performed modeling
For ACK001 as the response variable (mistakenly performed) Lasso gave us a model with the following variables:
- ACD001 - Total Population
- ACZ013 - Slave >> Male >> Under 10 years of age
- AC1003 - Persons Employed in Commerce
- AC1006 - Persons Employed in Navigation of canals, lakes, and rivers
- AC3002 - Number of Deaf and Dumb White Persons 14 to 24 years old
- ACE002 - Colored Blind Persons
- ACF003 - Colored Insane and Idiot Persons >> At public charge
- ACF004 - Colored Insane and Idiot Persons >> At private charge
- ACH001 - Universities or colleges
- ACM003 - Semi and tri-weekly newspapers
- ACR002 - Total White Female Population
- ACV002 - Total Female Population
- ADB020 - Fisheries: Barrels of Pickled Fish
- ADB026 - Bar Iron: Tons Produced
- ADB029 - Printing and Binding: Semi- and tri-weekly newspapers
- ADE002 - Men Employed in Mining Establishments: Lead
- ADE005 - Men Employed in Mining Establishments: Anthracite coal
- ADE017 - Men Employed in Manufacturing Establishments: Weapons
- ADE019 - Men Employed in Manufacturing Establishments: Various metals
- ADE024 - Men Employed in Manufacturing Establishments: Powder mills
- ADC017 - Capital Invested in Manufacturing Establishments: Cotton
- ADC036 - Capital Invested in Manufacturing Establishments: Carriages and wagons
- ADD003 - Persons employed in commerce
- ADD006 - Persons employed in inland navigation
- ACH - Total Learning Institutions

```{r}
pred_lasso <- predict(model_best,newx=x_all,s=lambda_best,type="response")
RMSE_lasso_all=sqrt(mean((y_all-pred_lasso)^2))
RMSE_lasso_all
```

### The full lasso model had an RMSE of $0.1184195$	using the best lambda value of $0.003542939$. This is an improvement over the testing lasso RMSE of $0.1248152$.



# best subset
```{r}
library(leaps)
train_bestsubset <- train %>%
  dplyr::select(ACKY, ACD001, ACN001, ACY, ACZYZ, ACH, ACI, ACL, ACM, AC1001, AC1002, AC1, ACE, AC3, AC9M, AC9C, AC9MF, ACS, ADAF, ADAMF, ADAM, ADCM, ADCC, ADCMFF, ADCMFT, ADCMFTH, ADCMFL, ADCMFSCL, ADCMFC, ADCMFGE, ADCMFFP, ADCMFPP, ADCMFO, ADEM, ADEC, ADEMF, AC5, AB2, AB5, AB8, ACSW, ACSNW, ACSP, ACSWP, Confederate)
# best_subset <- regsubsets(ACKY~.,data=train_bestsubset,method="exhaustive", nvmax=200, really.big=TRUE)
# summary(best_subset)
```


# For Paper 1 stuff
# Histograms of predictor variables distributions
```{r, message=FALSE}
modelvariables <- train %>%
  dplyr::select(ACKY, ACD001, ACN001, ACY, ACZYZ, ACH, ACI, ACL, ACM, AC1, ACE, ACS, ACSW, ACSNW, ACSP, ACSWP, Confederate, ACZ015, ACM002, ACX001, AC9022, AC9023, AC9027, ADA015, ADB028, ADC037, AB4009, AB7008, AB7013, AB7020, AB9001)

png("histograms.png", width = 1200, height = 1200, res=108)
par(mfrow=c(4, 5), mar=c(2, 2, 2, 1) + 0.1, oma=c(0, 0, 4, 0))
# Loop over numeric columns and create histograms
for (i in 1:ncol(modelvariables)) {
valid_data <- modelvariables[[i]][!is.na(modelvariables[[i]])]
if (length(valid_data) > 0) {
hist(valid_data, main=colnames(modelvariables)[i], xlab=colnames(modelvariables)[i],
col="lightblue", border="darkblue")  # Using light blue fill with dark blue borders
} else {
plot.new()
text(0.5, 0.5, "No data available")
}
}
mtext("Distributions of Predictor Variables: Histograms", side=3, outer=TRUE, line=1, cex=1.5)
#dev.off()
```